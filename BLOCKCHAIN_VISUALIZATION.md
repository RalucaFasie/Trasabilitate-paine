# Blockchain Visualization Implementation Guide

## ğŸ“‹ Overview

This implementation provides a blockchain visualization for the bread traceability system with two deployment options:

1. **Client-Side Hashing**: SHA-256 hashes calculated in the browser
2. **CI-Generated Data**: Hashes precomputed during GitHub Actions deployment

## ğŸ¯ Requirements Met

âœ… Deploy `docs/` folder to GitHub Pages  
âœ… All asset paths are relative  
âœ… GitHub Actions workflow builds and deploys  
âœ… Blockchain visualization with simulated data  
âœ… Display blocks with hash and previousHash  
âœ… Two implementation options (client-side & CI)  
âœ… Example HTML/JS with Romanian/English comments  
âœ… Static hosting compatible (no backend needed)  

## ğŸ“‚ File Structure

```
docs/
â”œâ”€â”€ index.html              # Main page with blockchain link
â”œâ”€â”€ blockchain.html         # Blockchain visualization page
â”œâ”€â”€ app.js                  # Option 1: Client-side hashing
â”œâ”€â”€ app-static.js          # Option 2: Load from JSON
â”œâ”€â”€ README.md              # Public folder documentation
â””â”€â”€ data/                  # Generated by CI (gitignored)
    â””â”€â”€ blocks.json        # Precomputed blockchain data

scripts/
â””â”€â”€ generate-blocks.js     # CI script to generate blockchain data

.github/workflows/
â””â”€â”€ static.yml            # GitHub Actions workflow
```

## ğŸ” Option 1: Client-Side Hashing (DEFAULT)

**File**: `docs/app.js`

### How It Works

1. Blockchain data is defined in JavaScript
2. When page loads, SHA-256 hashes are calculated using Web Crypto API
3. Each block's hash includes: index, timestamp, data, and previousHash
4. Blocks are rendered with their hashes displayed

### Code Example

```javascript
// Calculate SHA-256 in browser
async function sha256(message) {
    const msgBuffer = new TextEncoder().encode(message);
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

// Build blockchain
async function buildBlockchain() {
    const blockchain = [];
    let previousHash = '0'.repeat(64);
    
    for (const blockData of blockchainData) {
        const blockHash = await calculateBlockHash(blockData, previousHash);
        blockchain.push({
            ...blockData,
            previousHash,
            hash: blockHash
        });
        previousHash = blockHash;
    }
    return blockchain;
}
```

### Advantages

- âœ… No build step required
- âœ… Works immediately without CI
- âœ… Demonstrates real-time hashing
- âœ… Easy to modify data

### Usage

Simply open `blockchain.html` - it uses `app.js` by default.

## ğŸ—ï¸ Option 2: CI-Generated Static Data

**Files**: `scripts/generate-blocks.js` + `docs/app-static.js`

### How It Works

1. GitHub Actions runs on push to main
2. `generate-blocks.js` creates `docs/data/blocks.json`
3. JSON contains all blocks with precomputed hashes
4. `app-static.js` loads and displays the JSON

### CI Workflow

```yaml
# .github/workflows/static.yml
steps:
  - name: Install dependencies
    run: npm ci
  
  - name: Generate blockchain data
    run: node scripts/generate-blocks.js
  
  - name: Upload artifact (docs/ folder only)
    uses: actions/upload-pages-artifact@v3
    with:
      path: 'docs'
```

### Generated JSON Structure

```json
{
  "blockchain": [
    {
      "index": 0,
      "timestamp": "2025-10-15T08:00:00Z",
      "icon": "ğŸŒ±",
      "title": "Genesis Block",
      "data": { ... },
      "previousHash": "0000...0000",
      "hash": "380f2a987c6ef42a..."
    },
    ...
  ],
  "metadata": {
    "generatedAt": "2025-11-06T22:30:00.000Z",
    "totalBlocks": 6,
    "version": "1.0.0"
  }
}
```

### Advantages

- âœ… Faster page load (no computation)
- âœ… Hashes are consistent
- âœ… Can add metadata
- âœ… No dependency on Web Crypto API

### Usage

To switch to static data loading:

1. Edit `blockchain.html`
2. Change: `<script type="module" src="./app.js"></script>`
3. To: `<script type="module" src="./app-static.js"></script>`

## ğŸ”„ Blockchain Data Structure

Both options use the same data format:

```javascript
const blockchainData = [
    {
        index: 0,                           // Block number
        timestamp: '2025-10-15T08:00:00Z', // ISO 8601 timestamp
        icon: 'ğŸŒ±',                         // Emoji for display
        title: 'Genesis Block',            // Block title
        data: {                            // Block data (key-value pairs)
            'Tip': 'Bloc IniÈ›ial',
            'Network': 'Bread Traceability Chain'
        }
    },
    {
        index: 1,
        timestamp: '2025-10-20T10:30:00Z',
        icon: 'ğŸŒ¾',
        title: 'Ferma',
        data: {
            'Fermier': 'AgroVerde SRL',
            'LocaÈ›ie': 'CÄƒlÄƒraÈ™i, RomÃ¢nia',
            'CulturÄƒ': 'GrÃ¢u de toamnÄƒ',
            // ...
        }
    },
    // ... more blocks
];
```

## ğŸ¨ Blockchain Blocks

The system includes 6 blocks representing the supply chain:

1. **Genesis Block** (ğŸŒ±) - Initial blockchain block
2. **Ferma** (ğŸŒ¾) - Farm with crop information
3. **MoarÄƒ** (âš™ï¸) - Mill processing data
4. **Senzori IoT** (ğŸ“¡) - IoT sensor readings
5. **BrutÄƒrie** (ğŸ) - Bakery production details
6. **Magazin** (ğŸ›’) - Store/retail information

## ğŸ§ª Testing Locally

### Test Client-Side Hashing

```bash
cd docs
python -m http.server 8000
# or
npx serve .
```

Open: http://localhost:8000/blockchain.html

### Test Static Data Loading

```bash
# Generate the data
node scripts/generate-blocks.js

# Switch to app-static.js in blockchain.html
# Then start server
cd docs
python -m http.server 8000
```

## ğŸ”§ Modifying Blockchain Data

To add or modify blocks:

### For Client-Side Hashing

Edit `docs/app.js` - modify the `blockchainData` array.

### For CI-Generated Data

Edit `scripts/generate-blocks.js` - modify the `blockchainData` array, then:

```bash
node scripts/generate-blocks.js
```

## ğŸ“± UI Features

- **Responsive Design**: Works on mobile and desktop
- **Block Display**: Each block shows:
  - Block number and icon
  - Timestamp (formatted in Romanian)
  - Data fields (key-value pairs)
  - Previous hash (64 hex characters)
  - Current hash (64 hex characters)
- **Genesis Badge**: First block marked as GENESIS
- **Hover Effects**: Blocks animate on hover
- **Navigation**: Link back to main page

## ğŸŒ GitHub Pages Deployment

The workflow deploys **only** the `docs/` folder:

```yaml
- name: Upload artifact (docs/ folder only)
  uses: actions/upload-pages-artifact@v3
  with:
    path: 'docs'
```

This ensures the site URL structure is clean:
- âœ… `https://username.github.io/repo/` â†’ serves `docs/index.html`
- âœ… `https://username.github.io/repo/blockchain.html` â†’ blockchain page
- âœ… Relative paths work correctly

## ğŸ” Security Considerations

- âœ… No secrets in code
- âœ… SHA-256 hashing (standard cryptographic hash)
- âœ… Static hosting (no server vulnerabilities)
- âœ… No external dependencies loaded
- âœ… All resources self-hosted

## ğŸ“Š Performance

### Client-Side Hashing
- Initial load: ~100-200ms for hash calculation
- 6 blocks processed in < 50ms
- No network requests after page load

### Static Data
- Initial load: ~10-20ms
- One fetch request for blocks.json (~2KB)
- Immediate display

## ğŸ¯ Best Practices

1. **Use relative paths**: `./app.js` not `/app.js`
2. **Keep data in sync**: Same `blockchainData` in both files
3. **Test locally**: Always test before pushing
4. **Monitor CI**: Check GitHub Actions for build success
5. **Update gitignore**: Keep generated files out of git

## ğŸ› Troubleshooting

### Problem: Blockchain doesn't load

**Solution**: Check browser console for errors. Ensure:
- Web Crypto API is available (HTTPS or localhost)
- JSON file exists (for static option)
- JavaScript modules are supported

### Problem: Hashes don't match between options

**Solution**: Ensure `blockchainData` is identical in:
- `docs/app.js`
- `scripts/generate-blocks.js`

### Problem: GitHub Pages shows 404

**Solution**: 
- Check workflow ran successfully
- Verify `docs/` folder contains files
- Check GitHub Pages settings (should deploy from gh-pages branch or GitHub Actions)

## ğŸ“š Additional Resources

- [Web Crypto API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API)
- [GitHub Pages](https://docs.github.com/en/pages)
- [GitHub Actions](https://docs.github.com/en/actions)
- [SHA-256 Algorithm](https://en.wikipedia.org/wiki/SHA-2)

## ğŸ“ Learning Path

For users new to blockchain:

1. Start with `blockchain.html` (client-side) - see hashes calculated live
2. Open browser DevTools Console - see logs
3. Modify block data in `app.js` - see how hashes change
4. Try the static approach - understand the trade-offs
5. Build your own blocks - extend the chain!

---

**Created by**: GitHub Copilot  
**Date**: November 2025  
**Version**: 1.0.0
